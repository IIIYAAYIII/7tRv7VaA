RandomPIN - Magisk模块
========================

功能说明
--------
1. 锁屏PIN码乱序显示 - 防止被偷窥猜中密码
2. 双击屏幕空白处锁定屏幕

系统要求
--------
- Magisk v24.0+
- 安卓 10-16 (API 29-35+)
- PIN乱序功能需要LSPosed/Xposed框架支持

安装步骤
--------
方法一：快速安装（仅双击锁屏功能）

1. 运行 package.bat (Windows) 或 package.sh (Linux/Mac)
2. 将生成的 zip 文件传输到手机
3. 打开 Magisk Manager -> 模块 -> 从本地安装
4. 选择 zip 文件安装
5. 重启手机

方法二：完整安装（包含PIN乱序）

前置条件：
- 安装 Android SDK
- 安装 JDK 8+
- 安装 LSPosed 框架

步骤：
1. 编译 Xposed 模块：
   - Linux/Mac: ./build.sh
   - Windows: build.bat (需要手动转换为DEX)

2. 确认 system/framework/randompin.dex 已生成

3. 运行打包脚本生成 zip

4. 通过 Magisk 安装

5. 在 LSPosed 中启用此模块，勾选 SystemUI

6. 重启手机

配置选项
--------
通过adb shell配置：

# 显示当前配置
sh /data/adb/modules/randompin/common/config.sh show

# 启用/禁用PIN乱序
sh /data/adb/modules/randompin/common/config.sh set PIN_RANDOMIZE 1
sh /data/adb/modules/randompin/common/config.sh set PIN_RANDOMIZE 0

# 启用/禁用双击锁屏
sh /data/adb/modules/randompin/common/config.sh set DOUBLE_TAP_LOCK 1
sh /data/adb/modules/randompin/common/config.sh set DOUBLE_TAP_LOCK 0

# 设置双击间隔（毫秒）
sh /data/adb/modules/randompin/common/config.sh set DOUBLE_TAP_TIMEOUT 400

文件结构
--------
randompin/
├── module.prop           # 模块属性
├── system.prop           # 系统属性配置
├── service.sh            # 启动服务脚本
├── post-fs-data.sh       # 文件系统挂载后脚本
├── uninstall.sh          # 卸载脚本
├── xposed_init           # Xposed入口配置
├── META-INF/             # Magisk安装脚本
│   └── com/google/android/
│       ├── update-binary
│       └── updater-script
├── common/               # 通用脚本和配置
│   ├── config.sh         # 配置管理脚本
│   ├── service.sh        # 服务启动脚本
│   ├── post-fs-data.sh   # 预启动脚本
│   ├── double_tap_lock.sh      # 双击锁屏服务v1
│   └── double_tap_lock_v2.sh   # 双击锁屏服务v2
├── system/               # Systemless修改
│   └── framework/
│       └── randompin.dex # 编译后的Xposed模块
├── zygisk/               # Zygisk模块源码
│   ├── main.cpp
│   └── zygisk.hpp
└── xposed_src/           # Xposed模块源码
    ├── MainHook.java
    ├── Android15Hooks.java
    ├── IXposedHookLoadPackage.java
    ├── XC_LoadPackage.java
    ├── XC_MethodHook.java
    ├── XposedBridge.java
    └── XposedHelpers.java

编译说明
--------
Linux/Mac:
  chmod +x build.sh
  ./build.sh

Windows:
  1. 确保ANDROID_SDK环境变量已设置
  2. 运行 build.bat
  3. 如d8/dx不可用，需要手动转换class到dex

故障排除
--------
1. PIN乱序不生效：
   - 确认已安装LSPosed/Xposed
   - 在LSPosed中启用模块并勾选SystemUI
   - 检查/data/adb/lspd目录是否存在

2. 双击锁屏不工作：
   - 检查日志：cat /data/local/tmp/randompin.log
   - 确认getevent命令可用
   - 尝试切换到v2版本：
     修改service.sh，将double_tap_lock.sh改为double_tap_lock_v2.sh

3. 模块安装失败：
   - 确认Magisk版本>=24.0
   - 检查设备安卓版本是否在10-16范围内

注意事项
--------
- PIN乱序不影响密码输入，只是显示顺序改变
- 实际密码仍然是您设置的数字顺序
- 双击锁屏仅在不锁屏状态下生效
- 状态栏和导航栏区域的双击会被忽略

版本历史
--------
v1.0.0 - 初始版本
- 支持PIN码乱序显示
- 支持双击锁屏
- 支持安卓10-16
